#include <json/value.h>
#include <iostream>
#include <json/writer.h>
#include "PacketStatusInStatusRequest.h"
#include "../../PacketHandler.h"

void PacketStatusInStatusRequest::handle(const std::shared_ptr<Connection> &conn, const std::unique_ptr<ByteBuffer> &buffer, size_t *bytes_available) {
    std::cout << "Creating response JSON" << std::endl;

    // hardcoded response for now

    Json::Value response;
    response["version"]["name"] = "1.20.1";
    response["version"]["protocol"] = 763;
    response["players"]["max"] = 100;
    response["players"]["online"] = 0;
    response["description"]["text"] = "A C++ Minecraft Server";
    response["favicon"] = "data:image/png;base64,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";
    response["enforcesSecureChat"] = true;
    response["previewsChat"] = true;

    std::cout << "Creating packet" << std::endl;

    std::unique_ptr<Packet> responsePkt = std::make_unique<Packet>(0);

    std::cout << "writing JSON response to string" << std::endl;
    Json::StreamWriterBuilder builder;
    std::string responseStr = Json::writeString(builder, response);

    std::cout << "writing response str to buffer" << std::endl;

    ByteBuffer buf;
    buf.write_string(responseStr);

    responsePkt->setData(&buf, buf.get_data_length());

    std::cout << "Sending packet" << std::endl;

    PacketHandler::send_packet(conn, std::move(responsePkt));
}
